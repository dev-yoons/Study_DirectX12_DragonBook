# Chapter4_5. Direct3D의 초기화 - 예제 응용 프로그램 프레임워크

### 예제 응용 프로그램 프레임워크
--------------------------------------------------
##### D3DApp 클래스
* 이 책의 모든 예제 응용 프로그램은 일관되게 D3DApp 의 여섯 가상 함수를 재정의한다.
1. **Initialize** : 자원 할당, 장면 물체 초기화, 광원 설정 등 응용 프로그램 고유의 초기화 코드를 넣는다. 이 메서드의 기본 구현은 InitMainWindow, InitDirect3D를 호출하는 것이다.
2. **MsgProc** : 이 메서드에는 응용 프로그램 주 창의 메시지 처리부(윈도우 프로시저)를 넣는다. D3DApp::MsgProc이 처리하지 않거나 처리하여도 응용 프로그램에 적합하지 않은 어떤 메시지를 직접 처리하고 싶은 경우 재정의한다.
3. **CreateRtvAndDsvDescriptorHeaps** : RTV 서술자와 DSV 서술자를 응용 프로그램에 맞게 생성하는 데 쓰이는 가상함수이다. 기본 구현은 SwapChainBufferCount 개의 교환 사슬 버퍼에 대한 서술자들을 담는 RTV 힙 하나와 깊이 스텐실 버퍼에 대한 서술자 하나를 담는 DSV 힙 하나를 생성한다. 고급 렌더링 기법을 위해서는 이 메서드를 재정의해야 한다.
4. **OnResize** : 창의 크기가 변하면, 후면 버퍼와 깊이.스텐실 버퍼를 창의 새 클라이언트 영역에 맞게 조정하거나 다시 생성해야 한다. 후면 버퍼는 ResizeBuffers로 변경이 가능하지만, 깊이.스텐실 버퍼는 파괴한 후 다시 생성해야 한다. 창의 크기가 변했을 때 수행해야 하는 구체적인 작업을 이 메서드로 설정할 수 있다.
5. **Update** : 매 프레임 호출되는 추상 메서드 이다. 응용 프로그램 갱신 (애니메이션, 카메라 이동, 충돌 검출 등) 을 이 메서드로 구현한다.
6. **Draw** : 매 프레임 호출되는 추상 메서드 이다. 현재 프레임을 후면 버퍼에 실제로 그리기 위한 렌더링 명령들을 제출하는 작업을 수행한다. 다 그린 후에는 Present 메서드를 호출해서 후면 버퍼를 화면에 제시한다.

##### 프레임 통계치
* 초당 프레임 수(FPS) 는 1초 동안 처리한 프레임 개수를 세어서 계산한다.
* 프레임당 초 수는 FPS의 역수이다. (다만 주로 밀리초 단위로 계산한다.)
* 하지만 FPS는 곡선 형태의 변화를 띄기 때문에, Frame Time이 더 직관적이다.

##### 메시지 처리부
* 대체로 게임 응용 프로그램들은 Win32 메시지를 그리 많이 다루지 않는다.
* WM_ACTIVATE : 응용 프로그램이 활성화/비활성화 될 때 전달된다.
* WM_SIZE : 응용 프로그램 창의 크기가 바뀔 때 발생한다. 사용자가 창의 크기 조정 테두리를 계속해서 끌고 있는 경우가 있을 수 있으므로, WM_EXITSIZEMOVE 메시지가 왔을 때 버퍼들을 갱신하는 것이 좋다.
* WM_DESTROY 는 창이 파괴되려 할 때, WM_MENUCHAR 는 메뉴가 활성화되어 사용자가 키를 눌렀지만 키가 단축키나 니모닉에 해당하지 않을 때, WM_GETMINMAXINFO 는 창이 너무 작아지지 않게 한다.

##### Direct3D 초기화 예제
* ClearRenderTargetView : 지정된 렌더 대상을 지정된 색으로 지운다
* ClearDepthStencilView : 지정된 깊이.스텐실 버퍼를 지운다.
* 이 책의 예제는 매번 새로운 이미지로 프레임을 시작하므로, 프레임마다 먼저 후면 버퍼 렌더 대상과 깊이.스텐실 버퍼를 지운 후에 그리기 명령들을 실행한다.
* ID3D12GraphicsCommandList::OMSetRenderTargets : 렌더 대상과 깊이.스텐실 버퍼를 파이프라인에 묶는다.
* IDXGISwapChain::Present : 후면 버퍼와 전면 버퍼를 교환한다.