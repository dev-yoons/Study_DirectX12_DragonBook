# Chapter5_intro. 렌더링 파이프라인

### 개요
--------------------------------------------------
* 3차원 장면의 기하학적 서술과 가상 카메라의 위치 및 방향이 주어졌을 때, 현재 가상 카메라에 비친 3차원 장면의 모습에 근거해서 2차원 이미지를생성하는 데 필요한 일련의 단계들 전체를 **렌더링 파이프라인**이라고 부른다.

### 3차원의 환상
--------------------------------------------------
* 어떻게 3차원 장면을 2차원 모니터에 담을 것인가?
####
1. 소실점 - 시각 평행선들은 하나의 소실점으로 수렴한다. 이를 선 원근법, 또는 직선 원근법, 선형 원근법이라고 부른다.
2. 물체 겹침 - 불투명한 물체가 그 뒤에 있는 물체의 일부/전체를 가린다.
3. 조명/음영 - 3차원 물체의 입체적 형태와 부피를 묘사한다.
4. 그림자 - 장면에서 광원이 있는 위치를 말해주며, 지면에서 얼마나 떠있는지를 제시한다.

### 모형의 표현
--------------------------------------------------
* 일반적으로 Direct3D 응용 프로그램은 고형의 3차원 물체를 삼각형 메시로 근사하여 표현한다.
* 삼각형 외에 선, 점도 물체를 근사하는 데 사용할 수 있다. 예를 들어 곡선은 일련의 짧은 선분들로 근사 가능하다.

### 컴퓨터 색상의 기본 개념
--------------------------------------------------
* 컴퓨터 모니터는 픽셀마다 빨간색,녹색,파란색 빛을 섞어서 방출한다. 통칭 RGB라고 부른다.
* 모니터가 방출하는 적녹청색광의 세기에는 상한이 존재한다. 0~1로 정규화하면, 0은 빛이 전혀 없는 것, 1은 빛의 세기가 최대인 것을 나타낸다.

#### 색상 연산
* 색상 벡터를 연산(더하기/빼기)하여 다른 색상을 얻을 수 있다. 
* 내적/외적 같은 연산은 색상 벡터에 대해 별로 의미가 없다. 
* 하지만 색상벡터만의 연산으로 **변조**라고 부르는 **성분별 곱셈**이 있다.
$$ (c_r,c_g,c_b) \otimes (k_r, k_g, k_b) = (c_rk_r, c_gk_g,c_bk_b) $$ 
* 이 연산은 주로 조명 공식에 사용된다.예를 들어 입사광선의 색상이 (r,g,b) 라고 하고 표면이 입사광선의 적색광을 50%, 녹색광을 75%, 청색광을 25% 반사한다면 반사된 광선의 색은 다음과 같이 된다.
$$ (r,g,b) \otimes (0.5,0.75,0.25) = (0.5r,0.75g,0.25b)$$
* 색상 연산을 하다보면 색상 성분이 [0,1] 밖으로 나갈 수 있다. 하지만 반드시 이를 보정해줘야 하며, 이를 clamping이라고 부른다.

#### 128비트 색상
* 그래픽 응용 프로그램이 색을 다룰 땐 흔히 적,녹,청 외에 알파라고 부르는 색상 선분 하나를 색상 벡터에 도입한다. 알파 성분은 주로 색상의 불투명도를 나타낸다.
* 알파 성분을 도입한다는 것은 하나의 색상을 4차원 색상 벡터로 표현한다는 뜻이다. 즉 각 성분을 32비트 부동소수점값 하나로 표현한다면 하나의 색상을 표현하는 데 128비트가 필요하다.
* 코드에서는 XMVECTOR 형식을 이용하여 색상을 표현할 수 있으며, DirectXMath 라이브러리의 벡터 함수들로 SIMD의 혜택을 받을 수 있다.

#### 32비트 색상
* 각 성분당 1바이트 (8비트)를 할당해서 하나의 색상을 32비트로도 표현이 가능하다.
* DirectXMath 라이브러리는 32비트 색상의 저장을 위해 PackedVector 구조체를 제공한다.
* 정수 구간 [0,255]를 실숫값 구간 [0,1]로 사상하여 32비트 색상을 128비트로 변환도 가능하다. (각 성분을 255로 나누기)
* 반대로 128비트 색상을 32비트 색상으로 변환할 때에는 각 성분에 255를 곱하고 반올림하면 된다.
* 일반적으로 32비트 색상은 8비트 색상 성분 네 개를 하나의 32비트 정수 값 (ex. unsigned int)에 채워 넣은 (packed) 형태이기 때문에, 32비트 색상을 128비트 색상으로 변환하려면 추가적인 비트 연산이 필요하다. XMCOLOR가 실제로 32비트 색상형식인데, DirectMath 라이브러리는 XMCOLOR 하나를 받아 XMVECTOR를 돌려주는 메서드를 제공한다.
* XMCOLOR는 ARGB 배치를 사용한다.
* 128비트 색상은 정밀도가 높은 색상 연산이 필요한 픽셀 셰이더 같은 곳에 사용된다. 128비트는 유효자릿수가 많아 정밀도가 높지만, 최종적인 픽셀 색상은 일반적으로 후면 버퍼에 32비트 색상으로 저장된다.